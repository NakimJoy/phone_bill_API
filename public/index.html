<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Bill Calculator</title>
    <link rel="stylesheet" href="styles.css">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script defer src="./app.js"></script>
</head>

<body>
    <div class="container" x-data="totalPhoneBill">
        <h5 x-text="header"></h5>
        <h1>Total Phone Bill Price Plans</h1>
        <p style="font-family: cursive;">Discover your total savings with our tailored phone plans!</p>

        <div x-data="phoneBillWidget">
            <form @submit.prevent="calculateBill">
                <select x-model="selectedPlan">
                    <option value="">Price Plan</option>
                    <template x-for="plan in plans" :key="plan.id">
                        <option :value="plan.plan_name" x-text="plan.plan_name"></option>
                    </template>
                </select>
                <input type="text" x-model="actions" placeholder="call, sms, call">
                <button type="submit">Calculate Total</button>
            </form>

            <div x-text="total"></div>

            <!-- Historical Orders Table -->
            <h2>Historical Orders</h2>
            <table>
                <thead>
                    <tr>
                        <th>Plan Name</th>
                        <th>Actions</th>
                        <th>Total</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="(order, index) in orderHistory" :key="index">
                        <tr>
                            <td x-text="order.plan_name"></td>
                            <td x-text="order.actions"></td>
                            <td x-text="order.total"></td>
                            <td>
                                <button @click="deleteOrder(index)">Delete</button>
                            </td>
                        </tr>
                    </template>
                </tbody>
            </table>

            <!-- Total Bill Button -->
            <button @click="calculateTotalBill">Calculate Total Bill of Historical Orders</button>
            <div x-text="'Total Historical Bill: R' + historicalTotal"></div>
        </div>
    </div>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('totalPhoneBill', () => ({
                header: "Xinwelo's Best Price Plan App",
                init() { }
            }));

            Alpine.data('phoneBillWidget', () => ({
                plans: [
                    { id: 1, plan_name: 'basic', sms_price: 2.35, call_price: 0.37 },
                    { id: 2, plan_name: 'premium', sms_price: 1.75, call_price: 0.65 },
                    { id: 3, plan_name: 'business', sms_price: 1.85, call_price: 0.85 }
                ],
                selectedPlan: '',
                actions: '',
                total: '',
                orderHistory: [],
                historicalTotal: 0,

                async init() {
                    // Fetch plans from the API if needed
                },

                async calculateBill() {
                    // Example calculation logic
                    this.total = 0;
                    const plan = this.plans.find(p => p.plan_name === this.selectedPlan);
                    if (!plan) return;

                    const actionsArray = this.actions.split(', ');
                    actionsArray.forEach(action => {
                        if (action === 'sms') this.total += plan.sms_price;
                        if (action === 'call') this.total += plan.call_price;
                    });

                    this.orderHistory.push({
                        plan_name: this.selectedPlan,
                        actions: this.actions,
                        total: this.total.toFixed(2)
                    });
                },

                deleteOrder(index) {
                    this.orderHistory.splice(index, 1);
                },

                calculateTotalBill() {
                    this.historicalTotal = this.orderHistory.reduce((sum, order) => {
                        return sum + parseFloat(order.total);
                    }, 0).toFixed(2);
                }
            }));
        });
    </script>
</body>

</html>